# 将VINS（或任意里程计）的位姿直接发送给飞控

> 作者：张子宇

在我们之前广泛使用的Fast-Drone（浙大FAST-LAB开源的自主无人机项目）框架下，控制无人机的流程通常是这样的：
1. 通过MAVROS、realsense-ros等获得无人机数据
2. 通过VINS等里程计得到无人机位姿
3. 将位姿、目标点等数据送入EGO-Planner等规划框架，得到期望路径（位置、速度等）
4. 将位姿、期望路径等一并发送给px4-ctrl执行器，由它解算出**期望姿态和推力**，最终通过MAVROS发送给PX4执行

上述流程很标准，但是有以下问题：
- **定位不能独立于规划来控制无人机。** 即使你只是想测试一下里程计，也必须启动规划程序和px4-ctrl，只是不给它发送目标点而已。
- **不能利用飞控的全部能力。** px4-ctrl接管了从位置到姿态的所有控制环（位置-速度-姿态），而这本是飞控专职负责的事。
- **飞控必须全程工作在Offboard模式。** 这意味着，如果规划程序出现了问题（但定位仍然正常），导致没有及时发送指令，那么飞控会立即退回到自稳模式，定位程序对无人机的准确定位和悬停完全无能为力。

为此，我们需要将定位和